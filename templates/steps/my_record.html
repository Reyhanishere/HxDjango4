{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ race.name }} â€“ Rankings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {% comment %} <meta http-equiv="refresh" content="10"> {% endcomment %}
    <link rel="stylesheet" href="{% static 'css/style_steps.css'%}">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhaijaan+2:wght@400..800&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Baloo Bhaijaan 2'; 
      background: #f4f4f4;
      margin: 0;
      padding: 2rem;
      text-align: center;
    }

      h1 {
        color: #333;
        font-size: 1.5em;
      }
      .textBox{
        padding: 0.5rem 1rem;
        background-color: #d8d8d8;
        border-radius: 10px;
        max-width: 400px;
        text-align: center;
        margin: 1rem auto;
      }
      .btn{
        padding: 0.5rem 1rem;
        background-color: #d8d8d8;
        border-radius: 10px;
        box-shadow: 0 3px #666;
        color: #333;
        text-decoration: none;
        transition: 0.3s;
        display: inline-block;
        cursor: pointer;
      }
        
      .btn:hover{
        box-shadow: 0 0px #666;
      }
      #surveyTextArea{
        width: 90%;
        max-width: 400px;
        padding: 1rem;
        border-radius: 10px;
        font-size: 16px;
        margin-bottom: 1rem;
        margin-top: 0.5rem;
      }
      .form{
        padding: 1rem;
        display: flex;
        flex-direction: column;
        max-width: 400px;
        margin: 2rem auto;
        align-items: center;
        background-color: #f0f0f0;
        border-radius: 10px;
        text-align: right;
      }
      select{
        width: 60px;
        text-align: center;
        font-size: 16px;
        padding: 0.5rem;
        border-radius: 10px;
        margin-right: 0.25rem;
      }
      .realBtn{
        font-size: 18px;
        font-family: 'Baloo Bhaijaan 2';
        border: 1px solid #888;
        padding: 0.5rem 3rem;
        font-weight: 600;
      }
    </style>
  </head>
  <body dir="rtl">
    <h1>ğŸ {{ race.name }} ğŸ</h1>
    {% if score_matches %}
    <h2>Your Score: <span style="font-size:xxx-large">{{ record.score }}</span></h2>
        <p class=""></p>
    
        <div>
            <p class="textBox" style="display: inline-block; margin:0.5rem">
                Ø±ØªØ¨Û€ Ø´Ù…Ø§ Ø§Ø² Ù…ÛŒØ§Ù† {{ total_records }} Ù†ÙØ±: <b style="font-size:xx-large">{{ ranking }}  </b><span style="font-size:small">(ØªØ§ Ø¨Ù‡ Ø§ÛŒÙ† Ù„Ø­Ø¸Ù‡)</span>
            </p>
            <span onclick="location.reload()" class="btn">âŸ³</span>
        </div>
        <p class="textBox">Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ù†Ù…Ø±Ù‡: <b style="font-size:xx-large">{{ highest_score }}</b></p>
        {% if same_score_records > 1 %}
            <p class="textBox">ØªØ¹Ø¯Ø§Ø¯ Ø§ÙØ±Ø§Ø¯ Ø¨Ø§ Ø§Ù…ØªÛŒØ§Ø² Ù…Ø´Ø§Ø¨Ù‡ Ø´Ù…Ø§: <b style="font-size:x-large">{{ same_score_records }}</b></p>
        {% endif %}
    {% else %}
        <p class="textBox">We think that you manipulated the URL!</p>
    {% endif %}

    {% if not existing_survey %}
      <form method="post" class="form">
          {% csrf_token %}
          <p>Ù„Ø·ÙØ§ Ø¯Ø± Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ Ø²ÛŒØ± Ø´Ø±Ú©Øª Ú©Ù†ÛŒØ¯. Ø«Ø¨Øª Ø§Ù…ØªÛŒØ§Ø² Ù‡Ù… Ú©Ø§ÙÛŒâ€ŒØ³Øª.<br/> Ø¨Ù‡ Ù†Ø¸Ø± Ø´Ù…Ø§ Ø§ÛŒÙ† Survey Ø¯Ø± Ø®ØµÙˆØµ <b>{{race.name}}</b> Ú†Ù‡ Ù…ÛŒØ²Ø§Ù† Ù…ÙÛŒØ¯ Ø¨ÙˆØ¯ØŸ</p>
          <div>
            <label for="survey_score" style="align-self: flex-start;">Ø§Ø² Û± ØªØ§ Û±Û° Ú†Ù†Ø¯ Ø§Ù…ØªÛŒØ§Ø² Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŸ</label>
            <select name="survey_score" id="survey_score" required>
                {% for n in num_list %}
                <option value="{{ n }}">{{ n }}</option>
                {% endfor %}
            </select>
          </div>
          <label for="text_box" style="align-self: flex-start; margin-top: 1rem">Ø¯ÛŒØ¯Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ù‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯Ø± Ø¨Ø§Ú©Ø³ Ø²ÛŒØ± Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯.</label>
          <textarea name="text_box" rows="4" cols="" id="surveyTextArea"></textarea>
          <button type="submit" class="btn realBtn">Ø«Ø¨Øª</button>
      </form>
    {% else %}
      <div class="form">
        <p class="textBox">Ø´Ù…Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ Ø§ÛŒÙ† Ù…Ø³Ø§Ø¨Ù‚Ù‡ Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.</p>
        <p>Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ú©Ù‡ Ø¨Ù‡ Ù…Ø§ Ø¯Ø§Ø¯ÛŒØ¯: <b>{{ existing_survey.survey_score }}</b></p>
      {% if existing_survey.text_box %}
        <p style="align-self: flex-start;">Ù…ØªÙ† Ø´Ù…Ø§:<br/> {{ existing_survey.text_box }}</p>
      {% endif %}
      </div>
    {% endif %}

    <a href="{% url 'step_race_detail' race.step_set.first.id %}" class="btn">Ù…Ø±ÙˆØ± Ø¯ÙˆØ¨Ø§Ø±Û€ Ù¾Ø±Ø³Ø´â€ŒÙ‡Ø§</a>

    <script type="text/javascript">
      let textBox = document.querySelector('textarea[name="text_box"]');
      let selectBox = document.querySelector('select[name="survey_score"]');
      let hasStartedInteracting = false;

      // Detect tapping / clicking / changing the select element
      if (textBox) {
          ['focus', 'click', 'change', 'input'].forEach(eventType => {
              textBox.addEventListener(eventType, () => {
                  hasStartedInteracting = true;
              });
          });
      }

      if (selectBox) {
          ['focus', 'click', 'change', 'input'].forEach(eventType => {
              selectBox.addEventListener(eventType, () => {
                  hasStartedInteracting = true;
              });
          });
      }

      // Reload only if the user hasn't interacted
      setTimeout(() => {
          if (!hasStartedInteracting) {
              location.reload();
          }
      }, 10000);  // 10 seconds
  </script>

</body>
</html>
